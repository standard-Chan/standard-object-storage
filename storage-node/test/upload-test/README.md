# ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

ì´ ë””ë ‰í† ë¦¬ì—ëŠ” Object Storageì˜ íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë“¤ì´ ìˆìŠµë‹ˆë‹¤.

## íŒŒì¼ êµ¬ì¡°

- `upload.js`: ë‹¨ì¼ íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸
- `load-test.js`: ë™ì‹œ ì—…ë¡œë“œ ë¶€í•˜ í…ŒìŠ¤íŠ¸ (Node.js)
- `k6-load-test.js`: k6 ë¶€í•˜ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ â­ **ì¶”ì²œ**
- `run-k6-test.ps1`: k6 í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í—¬í¼ ìŠ¤í¬ë¦½íŠ¸ (Windows)
- `run-k6-test.sh`: k6 í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í—¬í¼ ìŠ¤í¬ë¦½íŠ¸ (Linux/macOS)
- `K6_LOAD_TEST.md`: k6 ë¶€í•˜ í…ŒìŠ¤íŠ¸ ìƒì„¸ ê°€ì´ë“œ
- `test-files/`: ë¶€í•˜ í…ŒìŠ¤íŠ¸ìš© ëœë¤ íŒŒì¼ ì €ì¥ ë””ë ‰í† ë¦¬ (ìë™ ìƒì„±)
- `test-results/`: k6 í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì €ì¥ ë””ë ‰í† ë¦¬ (ìë™ ìƒì„±)

## ì‚¬ìš© ë°©ë²•

### 1. ë‹¨ì¼ íŒŒì¼ ì—…ë¡œë“œ (`upload.js`)

íŠ¹ì • íŒŒì¼ì„ ì§€ì •ëœ ë²„í‚·ê³¼ ê²½ë¡œì— ì—…ë¡œë“œí•©ë‹ˆë‹¤.

```bash
# ê¸°ë³¸ ì‚¬ìš©ë²•
./upload.js <íŒŒì¼ê²½ë¡œ> <ë²„í‚·ëª…> <ê°ì²´í‚¤>

# ì˜ˆì‹œ
./upload.js sample.jpg bucket1 pictures/sample.jpg
./upload.js ../data/report.pdf documents reports/2024/report.pdf
```

**ë§¤ê°œë³€ìˆ˜:**
- `íŒŒì¼ê²½ë¡œ`: ì—…ë¡œë“œí•  ë¡œì»¬ íŒŒì¼ì˜ ê²½ë¡œ
- `ë²„í‚·ëª…`: ëŒ€ìƒ ë²„í‚· ì´ë¦„
- `ê°ì²´í‚¤`: ì €ì¥ë  ê°ì²´ì˜ ê²½ë¡œ ë° íŒŒì¼ëª…

### 2. k6 ë¶€í•˜ í…ŒìŠ¤íŠ¸ (`k6-load-test.js`) â­ **ì¶”ì²œ**

k6ë¥¼ ì‚¬ìš©í•œ ì „ë¬¸ì ì¸ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ë„êµ¬ì…ë‹ˆë‹¤. Presigned URL ë°œê¸‰ë¶€í„° ì‹¤ì œ íŒŒì¼ ì—…ë¡œë“œê¹Œì§€ ì „ì²´ í”„ë¡œì„¸ìŠ¤ë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.

#### k6 ì„¤ì¹˜

**Windows:**
```powershell
winget install k6
# ë˜ëŠ”
choco install k6
```

**macOS:**
```bash
brew install k6
```

**Linux:**
```bash
# Debian/Ubuntu
sudo gpg -k
sudo gpg --no-default-keyring --keyring /usr/share/keyrings/k6-archive-keyring.gpg \
  --keyserver hkp://keyserver.ubuntu.com:80 \
  --recv-keys C5AD17C747E3415A3642D57D77C6C491D6AC1D69
echo "deb [signed-by=/usr/share/keyrings/k6-archive-keyring.gpg] https://dl.k6.io/deb stable main" | \
  sudo tee /etc/apt/sources.list.d/k6.list
sudo apt-get update
sudo apt-get install k6
```

#### ë¹ ë¥¸ ì‹œì‘

**Windows (PowerShell):**
```powershell
# ê°€ë²¼ìš´ ë¶€í•˜ í…ŒìŠ¤íŠ¸ (10 VUs, 1ë¶„)
.\run-k6-test.ps1 -Scenario light

# ì¤‘ê°„ ë¶€í•˜ í…ŒìŠ¤íŠ¸ (50 VUs, 2ë¶„)
.\run-k6-test.ps1 -Scenario medium

# ë†’ì€ ë¶€í•˜ í…ŒìŠ¤íŠ¸ (100 VUs, 3ë¶„)
.\run-k6-test.ps1 -Scenario heavy

# ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ (200 VUs, 5ë¶„)
.\run-k6-test.ps1 -Scenario stress

# ì‚¬ìš©ì ì •ì˜
.\run-k6-test.ps1 -Scenario custom -VUs 150 -Duration 10m
```

**Linux/macOS:**
```bash
# ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
chmod +x run-k6-test.sh

# ê°€ë²¼ìš´ ë¶€í•˜ í…ŒìŠ¤íŠ¸
./run-k6-test.sh light

# ì¤‘ê°„ ë¶€í•˜ í…ŒìŠ¤íŠ¸
./run-k6-test.sh medium

# ë†’ì€ ë¶€í•˜ í…ŒìŠ¤íŠ¸
./run-k6-test.sh heavy

# ì‚¬ìš©ì ì •ì˜
VUS=150 DURATION=10m ./run-k6-test.sh custom
```

#### ì§ì ‘ k6 ëª…ë ¹ ì‹¤í–‰

```bash
# ê¸°ë³¸ ì‹¤í–‰ (10 VUs, 30ì´ˆ)
k6 run k6-load-test.js

# ë™ì‹œ ì‚¬ìš©ì ìˆ˜ì™€ ì§€ì† ì‹œê°„ ì§€ì •
k6 run --vus 50 --duration 1m k6-load-test.js

# ë‹¤ë¥¸ ë²„í‚· ì‚¬ìš©
k6 run --vus 20 --env BUCKET=my-bucket k6-load-test.js

# ê²°ê³¼ë¥¼ JSON íŒŒì¼ë¡œ ì €ì¥
k6 run --out json=results.json k6-load-test.js
```

**íŠ¹ì§•:**
- 1KB, 10KB, 100KB, 1MB, 10MB íŒŒì¼ í¬ê¸° ëœë¤ ì„ íƒ
- Presigned URL ë°œê¸‰ë¶€í„° íŒŒì¼ ì—…ë¡œë“œê¹Œì§€ ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
- ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ë° ì„ê³„ê°’(Threshold) ê²€ì¦
- ë™ì‹œ ì‚¬ìš©ì ìˆ˜(VUs) ìœ ì—°í•œ ì¡°ì ˆ
- ë‹¨ê³„ì  ë¶€í•˜ ì¦ê°€ ì§€ì› (Ramping)
- ìƒì„¸í•œ í†µê³„ ë° ë³´ê³ ì„œ

ğŸ“˜ **ìƒì„¸í•œ ì‚¬ìš©ë²•ì€ [K6_LOAD_TEST.md](./K6_LOAD_TEST.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.**

### 3. Node.js ë™ì‹œ ì—…ë¡œë“œ ë¶€í•˜ í…ŒìŠ¤íŠ¸ (`load-test.js`)

ì—¬ëŸ¬ íŒŒì¼ì„ ë™ì‹œì— ì—…ë¡œë“œí•˜ì—¬ ì‹œìŠ¤í…œ ì„±ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.

```bash
# ê¸°ë³¸ ì‚¬ìš©ë²•
./load-test.js <ë™ì‹œìš”ì²­ìˆ˜>

# ì˜ˆì‹œ
./load-test.js 10   # 10ê°œì˜ íŒŒì¼ì„ ë™ì‹œ ì—…ë¡œë“œ
./load-test.js 50   # 50ê°œì˜ íŒŒì¼ì„ ë™ì‹œ ì—…ë¡œë“œ
./load-test.js 100  # 100ê°œì˜ íŒŒì¼ì„ ë™ì‹œ ì—…ë¡œë“œ
```

**íŠ¹ì§•:**
- ë‹¤ì–‘í•œ í¬ê¸°ì˜ í…ŒìŠ¤íŠ¸ íŒŒì¼ ìë™ ìƒì„± (1KB, 10KB, 100KB, 1MB, 10MB)
- ê° ì—…ë¡œë“œë§ˆë‹¤ ê³ ìœ í•œ ê°ì²´ í‚¤ ìë™ ìƒì„±
- ì‹¤ì‹œê°„ ì§„í–‰ë¥  í‘œì‹œ
- ìƒì„¸í•œ í†µê³„ ë¦¬í¬íŠ¸ ì œê³µ
  - ì„±ê³µ/ì‹¤íŒ¨ ë¹„ìœ¨
  - ì‘ë‹µ ì‹œê°„ í†µê³„ (í‰ê· , ìµœì†Œ, ìµœëŒ€)
  - íŒŒì¼ í¬ê¸°ë³„ í†µê³„
  - ì²˜ë¦¬ëŸ‰ (ìš”ì²­/ì´ˆ)

**ì¶œë ¥ ì˜ˆì‹œ:**
```
ğŸ“ í…ŒìŠ¤íŠ¸ íŒŒì¼ ì¤€ë¹„ ì¤‘...

âœ… í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±: test-1kb.bin (1 KB)
âœ… í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±: test-10kb.bin (10 KB)
âœ… í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±: test-100kb.bin (100 KB)
âœ… í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±: test-1mb.bin (1 MB)
âœ… í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±: test-10mb.bin (10 MB)

ğŸ“¤ 10ê°œì˜ ë™ì‹œ ì—…ë¡œë“œ ì‹œì‘...

ì§„í–‰ ì¤‘... 10/10 (100%)

============================================================
ğŸ“Š ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼
============================================================

ì´ ìš”ì²­ ìˆ˜: 10ê°œ
ì„±ê³µ: 10ê°œ (100.0%)
ì‹¤íŒ¨: 0ê°œ (0.0%)

â±ï¸  ì‘ë‹µ ì‹œê°„ í†µê³„:
   í‰ê· : 245ms
   ìµœì†Œ: 123ms
   ìµœëŒ€: 456ms

ğŸ“¦ íŒŒì¼ í¬ê¸°ë³„ í†µê³„:
   1KB: 2ê°œ ì—…ë¡œë“œ, í‰ê·  145ms
   10KB: 3ê°œ ì—…ë¡œë“œ, í‰ê·  198ms
   100KB: 2ê°œ ì—…ë¡œë“œ, í‰ê·  287ms
   1MB: 2ê°œ ì—…ë¡œë“œ, í‰ê·  356ms
   10MB: 1ê°œ ì—…ë¡œë“œ, í‰ê·  456ms

ğŸ• ì „ì²´ ì†Œìš” ì‹œê°„: 1.23ì´ˆ
ğŸ“ˆ ì²˜ë¦¬ëŸ‰: 8.13 ìš”ì²­/ì´ˆ

============================================================
```

## ìš”êµ¬ì‚¬í•­

- Node.js 18 ì´ìƒ
- Control Planeì´ `http://localhost:8080`ì—ì„œ ì‹¤í–‰ ì¤‘
- Storage Nodeê°€ `http://localhost:3000`ì—ì„œ ì‹¤í–‰ ì¤‘

## í…ŒìŠ¤íŠ¸ ì „ í™•ì¸ì‚¬í•­

1. **ì„œë¹„ìŠ¤ ì‹¤í–‰ í™•ì¸**
   ```bash
   # Control Plane ì‹¤í–‰
   cd control-plane
   ./gradlew bootRun
   
   # Storage Node ì‹¤í–‰
   cd storage-node
   npm run dev
   ```

2. **ë²„í‚· ìƒì„±**
   - Control Plane API ë˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸ìš© ë²„í‚·(ì˜ˆ: `bucket1`) ìƒì„±

3. **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**
   - Storage Nodeì˜ `PRESIGNED_URL_SECRET_KEY` ì„¤ì • í™•ì¸

## ì£¼ì˜ì‚¬í•­

- ë¶€í•˜ í…ŒìŠ¤íŠ¸ íŒŒì¼ì€ `test-files/` ë””ë ‰í† ë¦¬ì— ìë™ ìƒì„±ë˜ë©° ì¬ì‚¬ìš©ë©ë‹ˆë‹¤
- ì—…ë¡œë“œëœ í…ŒìŠ¤íŠ¸ íŒŒì¼ì€ `bucket1/load-test/` ê²½ë¡œì— ì €ì¥ë©ë‹ˆë‹¤
- ë„ˆë¬´ ë§ì€ ë™ì‹œ ìš”ì²­ì€ ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ë¥¼ ë§ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë‹ˆ ì£¼ì˜í•˜ì„¸ìš”
- í…ŒìŠ¤íŠ¸ í›„ ë¶ˆí•„ìš”í•œ íŒŒì¼ì€ ì •ë¦¬í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤
