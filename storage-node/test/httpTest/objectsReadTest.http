@controlPlaneUrl = http://localhost:8080
@storageNodeUrl = http://localhost:3000

### 1. Presigned URL 발급 (GET 전용)

### 1-1. 사진 읽기용 Presigned URL 발급
# @name presignedUrlPhoto
POST {{controlPlaneUrl}}/api/storage/presigned-url/get
Content-Type: application/json

{
  "bucket": "bucket1",
  "key": "picture/a/abcds.jpg"
}

### 2. 발급받은 URL로 파일 다운로드

### 2-1. 사진 파일 다운로드 (위에서 발급받은 URL 사용)
### 주의: 아래 URL을 위에서 받은 presignedUrl로 교체하세요
GET http://localhost:3000/objects/bucket1/picture/a/abcds.jpg?bucket=bucket1&objectKey=picture/a/abcds.jpg&method=GET&exp=1771734690&signature=REPLACE_WITH_ACTUAL_SIGNATURE

###
### 성공 시 이미지 파일이 직접 응답됨
### Content-Type: image/jpeg
### (바이너리 데이터)

###############################################
### 3. 다양한 파일 타입 다운로드 테스트
###############################################

### 3-1. PDF 문서 읽기용 Presigned URL 발급
# @name presignedUrlDocument
POST {{controlPlaneUrl}}/api/storage/presigned-url/get
Content-Type: application/json

{
  "bucket": "documents",
  "key": "reports/2024/annual-report.pdf"
}

### 3-2. PDF 파일 다운로드
### 주의: 실제 발급받은 URL로 교체하세요
GET http://localhost:3000/objects/documents/reports/2024/annual-report.pdf?bucket=documents&objectKey=reports/2024/annual-report.pdf&method=GET&exp=1771734690&signature=REPLACE_WITH_ACTUAL_SIGNATURE

###
### Content-Type: application/pdf

###############################################
### 4. 중첩된 경로 테스트
###############################################

### 4-1. 깊은 경로의 이미지 읽기용 Presigned URL 발급
# @name presignedUrlDeepPath
POST {{controlPlaneUrl}}/api/storage/presigned-url/get
Content-Type: application/json

{
  "bucket": "photos",
  "key": "users/123/albums/vacation/beach.png"
}

### 4-2. 깊은 경로 파일 다운로드
### 주의: 실제 발급받은 URL로 교체하세요
GET http://localhost:3000/objects/photos/users/123/albums/vacation/beach.png?bucket=photos&objectKey=users/123/albums/vacation/beach.png&method=GET&exp=1771734690&signature=REPLACE_WITH_ACTUAL_SIGNATURE

###
### Content-Type: image/png

###############################################
### 5. 오류 시나리오 테스트
###############################################

### 5-1. 잘못된 서명으로 다운로드 시도 (403 Forbidden 예상)
GET {{storageNodeUrl}}/objects/bucket1/picture/a/abcds.jpg?bucket=bucket1&objectKey=picture/a/abcds.jpg&method=GET&exp=2000000000&signature=invalid_signature_here

###
### 예상 응답 (403):
### {
###   "success": false,
###   "message": "서명이 유효하지 않습니다"
### }

### 5-2. 만료된 URL로 다운로드 시도 (403 Forbidden 예상)
GET {{storageNodeUrl}}/objects/bucket1/picture/a/abcds.jpg?bucket=bucket1&objectKey=picture/a/abcds.jpg&method=GET&exp=1000000000&signature=REPLACE_WITH_ACTUAL_SIGNATURE

###
### 예상 응답 (403):
### {
###   "success": false,
###   "message": "요청이 만료되었습니다"
### }

### 5-3. 존재하지 않는 파일 다운로드 시도 (404 Not Found 예상)
GET {{storageNodeUrl}}/objects/bucket1/picture/nonexistent.jpg?bucket=bucket1&objectKey=picture/nonexistent.jpg&method=GET&exp=2000000000&signature=REPLACE_WITH_ACTUAL_SIGNATURE

###
### 예상 응답 (404):
### {
###   "success": false,
###   "message": "파일을 찾을 수 없습니다: bucket1/picture/nonexistent.jpg"
### }

### 5-4. 잘못된 HTTP 메서드로 요청 (400 Bad Request 예상)
GET {{storageNodeUrl}}/objects/bucket1/picture/a/abcds.jpg?bucket=bucket1&objectKey=picture/a/abcds.jpg&method=PUT&exp=2000000000&signature=REPLACE_WITH_ACTUAL_SIGNATURE

###
### 예상 응답 (400):
### {
###   "success": false,
###   "message": "HTTP 메서드가 일치하지 않습니다"
### }

###############################################
### 6. 다양한 Content-Type 확인 테스트
###############################################

### 6-1. JPG 이미지 (image/jpeg) - 실제 URL로 교체
GET {{storageNodeUrl}}/objects/test/sample.jpg?bucket=test&objectKey=sample.jpg&method=GET&exp=2000000000&signature=REPLACE

### 6-2. PNG 이미지 (image/png) - 실제 URL로 교체
GET {{storageNodeUrl}}/objects/test/sample.png?bucket=test&objectKey=sample.png&method=GET&exp=2000000000&signature=REPLACE

### 6-3. GIF 이미지 (image/gif) - 실제 URL로 교체
GET {{storageNodeUrl}}/objects/test/sample.gif?bucket=test&objectKey=sample.gif&method=GET&exp=2000000000&signature=REPLACE

### 6-4. PDF 문서 (application/pdf) - 실제 URL로 교체
GET {{storageNodeUrl}}/objects/test/document.pdf?bucket=test&objectKey=document.pdf&method=GET&exp=2000000000&signature=REPLACE

### 6-5. JSON 파일 (application/json) - 실제 URL로 교체
GET {{storageNodeUrl}}/objects/test/data.json?bucket=test&objectKey=data.json&method=GET&exp=2000000000&signature=REPLACE

### 6-6. TXT 파일 (text/plain) - 실제 URL로 교체
GET {{storageNodeUrl}}/objects/test/readme.txt?bucket=test&objectKey=readme.txt&method=GET&exp=2000000000&signature=REPLACE

### 6-7. ZIP 파일 (application/zip) - 실제 URL로 교체
GET {{storageNodeUrl}}/objects/test/archive.zip?bucket=test&objectKey=archive.zip&method=GET&exp=2000000000&signature=REPLACE

### 6-8. 확장자 없는 파일 (application/octet-stream) - 실제 URL로 교체
GET {{storageNodeUrl}}/objects/test/noextension?bucket=test&objectKey=noextension&method=GET&exp=2000000000&signature=REPLACE

###############################################
### 사용 가이드
###############################################
###
### 1. Control-plane과 Storage-node가 모두 실행 중인지 확인
###    - Control-plane: http://localhost:8080
###    - Storage-node: http://localhost:3000
###
### 2. 테스트 순서
###    Step 1: 먼저 objectsTest.http로 파일 업로드 (PUT)
###    Step 2: GET용 Presigned URL 발급 요청 (Control-plane)
###    Step 3: 응답에서 presignedUrl 복사
###    Step 4: 복사한 URL로 파일 다운로드 요청 (Storage-node)
###
### 3. Content-Type 확인
###    - 응답 헤더의 Content-Type이 파일 확장자에 맞게 설정되었는지 확인
###    - 브라우저에서 URL을 열면 이미지는 표시되고, 문서는 다운로드됨
###
### 4. VS Code에서 사용하는 경우
###    - REST Client 확장 설치 필요
###    - "Send Request" 링크를 클릭하여 요청 실행
###
### 5. IntelliJ에서 사용하는 경우
###    - HTTP Client 기본 제공
###    - Run 아이콘을 클릭하여 요청 실행
###